name: {{FRAMEWORK_NAME}}
scheduler:
  principal: {{FRAMEWORK_PRINCIPAL}}
pods:
  nifi:
    count: {{NODE_COUNT}}
    placement: {{NODE_PLACEMENT}}
    user: {{FRAMEWORK_USER}}
    {{#ENABLE_VIRTUAL_NETWORK}}
    networks:
      {{VIRTUAL_NETWORK_NAME}}:
    {{/ENABLE_VIRTUAL_NETWORK}}
    rlimits:
      RLIMIT_NOFILE:
        soft: {{NODE_RLIMIT_NOFILE_SOFT}}
        hard: {{NODE_RLIMIT_NOFILE_HARD}}
      RLIMIT_NPROC:
        soft: {{NODE_RLIMIT_NPROC_SOFT}}
        hard: {{NODE_RLIMIT_NPROC_HARD}}
    uris:
      - {{BOOTSTRAP_URI}}
      - {{NIFI_BOOTSTRAP_URI}}
      - {{NIFI_URI}}
    tasks:
      node:
        goal: RUNNING
        cmd: >
                ./bootstrap &&
                ./nifi-${NIFI_VERSION}/bin/nifi.sh start &&
                tail -f ./nifi-${NIFI_VERSION}/logs/nifi-app.log
        cpus: {{NODE_CPUS}}
        memory: {{NODE_MEM}}
        ports:
          web:
            port: {{NODE_PORT}}
            vip:
              prefix: {{NODE_VIP_PREFIX}}
              port: {{NODE_VIP_PORT}}
          protocol:
            port: {{NIFI_CLUSTER_NODE_PROTOCOL_PORT}}
        volumes:
          database-repository:
            path: {{NODE_DATABASE_REPOSITORY_DISK_PATH}}
            type: {{NODE_DATABASE_REPOSITORY_DISK_TYPE}}
            size: {{NODE_DATABASE_REPOSITORY_DISK_SIZE}}
          flowfile-repository:
            path: {{NODE_FLOWFILE_REPOSITORY_DISK_PATH}}
            type: {{NODE_FLOWFILE_REPOSITORY_DISK_TYPE}}
            size: {{NODE_FLOWFILE_REPOSITORY_DISK_SIZE}}
          provenance-repository:
            path: {{NODE_PROVENANCE_REPOSITORY_DISK_PATH}}
            type: {{NODE_PROVENANCE_REPOSITORY_DISK_TYPE}}
            size: {{NODE_PROVENANCE_REPOSITORY_DISK_SIZE}}
          content-repository:
            path: {{NODE_CONTENT_REPOSITORY_DISK_PATH}}
            type: {{NODE_CONTENT_REPOSITORY_DISK_TYPE}}
            size: {{NODE_CONTENT_REPOSITORY_DISK_SIZE}}
        configs:
          nifi.properties:
            template: {{CONFIG_TEMPLATE_PATH}}/nifi.properties.mustache
            dest: nifi-{{NIFI_VERSION}}/conf/nifi.properties
          authorizers.xml:
            template: {{CONFIG_TEMPLATE_PATH}}/authorizers.xml.mustache
            dest: nifi-{{NIFI_VERSION}}/conf/authorizers.xml
          login-identity-providers.xml:
            template: {{CONFIG_TEMPLATE_PATH}}/login-identity-providers.xml.mustache
            dest: nifi-{{NIFI_VERSION}}/conf/login-identity-providers.xml
        env:
          NODE_COUNT: {{NODE_COUNT}}
          NODE_CPUS: {{NODE_CPUS}}
          NODE_MEM: {{NODE_MEM}}
plans:
  deploy:
    strategy: serial
    phases:
      node-deploy:
        strategy: {{DEPLOY_STRATEGY}}
        pod: nifi
  update:
    strategy: serial
    phases:
      node-update:
        strategy: {{UPDATE_STRATEGY}}
        pod: nifi
  replace:
    strategy: serial
    phases:
      node-replace:
        strategy: {{REPLACE_STRATEGY}}
        pod: nifi
